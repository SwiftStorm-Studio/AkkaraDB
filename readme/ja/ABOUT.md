# AkkaraDB について

AkkaraDBは、JVM上で動作する**超低レイテンシ**な組み込みキーバリューストアです。Kotlinで実装され、予測可能なテールレイテンシとシンプルな運用モデルを提供します。

## 🎯 主な特徴

### ⚡ 超低レイテンシ

- **P99書き込みレイテンシ**: ≤ 60 µs（WAL耐久化込み）
- **P99読み取りレイテンシ**: ≈ 12 µs（メモリキャッシュヒット時）
- NVMe SSD最適化による高速I/O

### 🛡️ クラッシュセーフ

- **WAL（Write-Ahead Log）**: 全ての書き込みは耐久化前にログに記録
- **Manifest**: システム状態を追記専用ログで管理
- **Stripe冗長性**: オプションでk+mパリティによるデータ保護（XOR、Reed-Solomon対応）

### 📦 ゼロ依存

- 外部ランタイム依存なし（JDK + Kotlinのみ）
- 組み込み可能な軽量設計
- オプションでPrometheusメトリクスをサポート

### 🔧 柔軟なAPI

- **低レベルAPI**: `ByteBufferL`による直接操作
- **型付きDSL**: Kotlinコンパイラプラグインによる型安全なクエリ
- **Java互換性**: 将来的にJDBC DataSource、Criteria API対応予定

## 🏗️ アーキテクチャ概要

AkkaraDBは以下のコンポーネントで構成されています：

```
┌─────────────────────────────────────────┐
│           Typed API (AkkDSL)            │  ← Kotlinコンパイラプラグイン
├─────────────────────────────────────────┤
│          Low-level Engine API           │  ← put/get/delete/CAS
├──────────┬──────────┬───────────────────┤
│ MemTable │   WAL    │   SSTable (LSM)   │
├──────────┴──────────┴───────────────────┤
│      Stripe (k+m Parity Lanes)          │  ← オプション冗長性
├─────────────────────────────────────────┤
│    Block Format (AKHdr32 + Payload)     │
└─────────────────────────────────────────┘
```

### データフロー

1. **書き込み**: `put/delete` → WAL書き込み（耐久化） → MemTable更新 → ACK
2. **読み取り**: `get` → MemTable検索 → SSTable検索（Bloomフィルター使用） → Stripe fallback（オプション）
3. **フラッシュ**: MemTableが閾値超過 → L0 SSTに書き出し → コンパクション
4. **リカバリ**: Manifest読み込み → WAL再生 → ストライプ検証

詳細は[アーキテクチャ](./ARCHITECTURE.md)を参照してください。

## 🎓 設計原則

### 核心不変条件（Core Invariants）

1. **グローバルシーケンス**: u64単調増加、DB全体で一意
2. **置換ルール**:
    - より高いseqが勝つ
    - seq同値の場合、tombstoneが勝つ（復活なし）
3. **キー順序**: バイトワイズ辞書順
4. **耐久性境界**: 書き込みACK = WAL耐久化完了時
5. **リカバリ保証**: last durable WAL ≤ last sealed manifest

### パフォーマンスチューニング戦略

- **書き込みテール改善**: `walGroupN`を増やす（バッチ効果）
- **読み取りテール改善**: インデックス/Bloomをメモリピン、ページキャッシュ調整
- **コンパクション停滞**: L0閾値調整、コンパクションリソース追加

## 📊 ユースケース

### 適している用途

- 低レイテンシが要求されるリアルタイムアプリケーション
- 組み込みデータベースが必要なJVMアプリケーション
- トランザクションログ、セッションストア
- キャッシュ層（永続化付き）

### 適していない用途

- 分散合意が必要な場合（現在は単一ノードのみ）
- 複雑なセカンダリインデックスが必要な場合
- デフォルト暗号化が必要な場合

## 🔮 今後の計画

- [ ] Java互換レイヤ（JDBC DataSource、Criteria API）
- [ ] 24時間安定性テスト
- [ ] クラッシュインジェクションテスト
- [ ] WebGUI デバッガツール
- [ ] 分散レプリケーション（将来のv4以降）

---

次のステップ: [インストール](./INSTALLATION.md) | [クイックスタート](./QUICKSTART.md)

---